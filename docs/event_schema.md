# B.O.S.S. Event Schema Definition

## Overview
This document is the single source of truth for all event types and their payload structures within the B.O.S.S. system. All components (core, hardware, apps) that publish or subscribe to events MUST adhere to these schemas.

---

## General Payload Structure
All event payloads should, where possible, include these top-level keys:

- `timestamp` (float): A `time.time()` timestamp for when the event was generated.
- `source` (str): A string identifying the origin of the event (e.g., 'hardware.button', 'core.app_manager', 'app.app_matrixrain').

---

## 1. System Events
Events related to the core application's state.

### `system.startup`
- **Description:** Published once when the main application has successfully initialized all components.
- **Payload:**
  | Field       | Type    | Required | Description                               |
  |-------------|---------|----------|-------------------------------------------|
  | `mode`      | `str`   | Yes      | 'real' or 'mock' for hardware status.     |

### `system.shutdown`
- **Description:** Published when the application is beginning its shutdown sequence.
- **Payload:**
  | Field       | Type    | Required | Description                               |
  |-------------|---------|----------|-------------------------------------------|
  | `reason`    | `str`   | No       | Optional reason for shutdown (e.g., 'user_request', 'error'). |

### `system.error`
- **Description:** Published when an unhandled exception or critical error occurs.
- **Payload:**
  | Field       | Type    | Required | Description                               |
  |-------------|---------|----------|-------------------------------------------|
  | `component` | `str`   | Yes      | The component where the error originated. |
  | `message`   | `str`   | Yes      | The error message.                        |
  | `traceback` | `str`   | No       | A formatted traceback string, if available. |

---

## 2. Hardware Input Events
Events generated by user interaction with physical controls.

### `input.button.pressed` / `input.button.released`
- **Description:** Published when a color button or the main "Go" button is pressed or released.
- **Payload:**
  | Field       | Type    | Required | Description                               |
  |-------------|---------|----------|-------------------------------------------|
  | `button_id` | `str`   | Yes      | 'red', 'yellow', 'green', 'blue', 'main'. |

### `input.switch.changed`
- **Description:** Published whenever the 8-switch value changes.
- **Payload:**
  | Field          | Type    | Required | Description                               |
  |----------------|---------|----------|-------------------------------------------|
  | `current_value`| `int`   | Yes      | The new value from the switches (0-255).  |
  | `previous_value`| `int`   | Yes      | The previous value.                       |

---

## 3. App Lifecycle Events
Events published by the `AppManager` as it controls mini-apps.

### `app.starting`
- **Description:** Published just before a mini-app is loaded and started.
- **Payload:**
  | Field       | Type    | Required | Description                               |
  |-------------|---------|----------|-------------------------------------------|
  | `app_name`  | `str`   | Yes      | The name of the app being started.        |
  | `switch_value`| `int` | Yes      | The switch value that triggered the launch. |

### `app.started`
- **Description:** Published immediately after an app's thread has been started.
- **Payload:**
  | Field       | Type    | Required | Description                               |
  |-------------|---------|----------|-------------------------------------------|
  | `app_name`  | `str`   | Yes      | The name of the app that started.         |

### `app.stopping`
- **Description:** Published when a request to stop an app has been initiated (e.g., stop event set).
- **Payload:**
  | Field       | Type    | Required | Description                               |
  |-------------|---------|----------|-------------------------------------------|
  | `app_name`  | `str`   | Yes      | The name of the app being stopped.        |
  | `reason`    | `str`   | Yes      | 'user_request', 'timeout', 'shutdown'.    |

### `app.stopped`
- **Description:** Published after an app's thread has terminated.
- **Payload:**
  | Field       | Type    | Required | Description                               |
  |-------------|---------|----------|-------------------------------------------|
  | `app_name`  | `str`   | Yes      | The name of the app that stopped.         |

---

## 4. Hardware Output Events (for Auditing/Logging)
These events are published by the hardware abstraction layer to confirm an action was taken. This is useful for logging, debugging, and remote monitoring.

### `output.led.state_changed`
- **Payload:**
  | Field       | Type    | Required | Description                               |
  |-------------|---------|----------|-------------------------------------------|
  | `led_id`    | `str`   | Yes      | 'red', 'yellow', 'green', 'blue'.         |
  | `state`     | `str`   | Yes      | 'on', 'off', 'blink'.                     |

### `output.display.updated`
- **Payload:**
  | Field       | Type    | Required | Description                               |
  |-------------|---------|----------|-------------------------------------------|
  | `value`     | `str`   | Yes      | The 4-character string sent to the display. |

### `output.screen.updated`
- **Payload:**
  | Field       | Type    | Required | Description                               |
  |-------------|---------|----------|-------------------------------------------|
  | `action`    | `str`   | Yes      | 'clear', 'display_text', 'display_image'. |
  | `details`   | `dict`  | No       | A dictionary of parameters used for the action. |

---

## 5. Command Events (Future/Proposed)

**Note:** The primary mechanism for mini-apps to control hardware is the direct `Mini-App API` (e.g., `api.leds['red'].on()`). This provides a simple, imperative way to issue commands.

Command events are a more advanced pattern for highly decoupled systems. They are not used by default but could be implemented for specific use cases. A component would publish a "command" event, and a handler somewhere else in the system would subscribe to it and execute the action.

### Example: `command.led.set_state` (Not Implemented)
- **Description:** A hypothetical event to request a change to an LED's state.
- **Payload:**
  | Field       | Type    | Required | Description                               |
  |-------------|---------|----------|-------------------------------------------|
  | `led_id`    | `str`   | Yes      | 'red', 'yellow', 'green', 'blue'.         |
  | `state`     | `str`   | Yes      | 'on', 'off', 'blink'.                     |
  | `params`    | `dict`  | No       | Optional parameters for blinking (e.g., `{'on_time': 0.2}`). |